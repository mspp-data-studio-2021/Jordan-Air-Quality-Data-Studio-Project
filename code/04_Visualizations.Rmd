---
title: "04_Visualizations"
output: html_document
author: Jordan Koster
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
loading needed packages 
```{r}
library(tidyverse)
library(fs)
library(skimr)
library(ggpubr)
library(broom)
library(ggpmisc)
library(ggplot2)
library(plotly)
```
In this notebook, I want to create some additional visualizations 

First I want to show how aqi has changed over the time period I'm looking at (bar graph)
```{r}
ggplot(merged_data) +
  aes(x = date, y = aqi, fill = pollutant) +
  geom_col(stat = "identity", position = "dodge") +
  scale_x_date(date_labels = "%Y-%m") +
  scale_y_continuous(labels = scales::label_number_si()) +
  labs(
    title = "AQI levels from March 2020-March 2021",
    subtitle = "By Pollutant: Ozone and PM2.5",
    fill = NULL,
    x = "Date",
    y = "AQI Level",
    caption = "Source: EPA"
  )
```
Next I want to visualize the changing aqi separately by pollutant 
Ozone bar graph:
```{r}
merged_data %>% 
  filter(pollutant %in% c("Ozone")) %>% 
  ggplot() +
    aes(x = date, y = aqi, fill = pollutant) +
    geom_col() +
    scale_x_date(date_labels = "%Y-%m") +
    scale_y_continuous(labels = scales::label_number_si()) +
    theme_minimal() +
    theme(
     panel.grid.major.y = element_blank(),
     axis.text.y = element_text(margin = margin(r = -15)),
     plot.caption = element_text(face = "italic", color = "darkgrey", margin = margin(t = 10))
  ) +
    labs(
      title = "AQI levels from March 2020-March 2021",
      subtitle = "Pollutant: Ozone",
      fill = NULL,
      x = "Date",
      y = "AQI Level",
      caption = "Source: EPA"
    )
```
PM2.5 bar graph: 
```{r}
merged_data %>% 
  filter(pollutant %in% c("PM2.5")) %>% 
  ggplot() +
    aes(x = date, y = aqi, fill = pollutant) +
    geom_col() +
    scale_x_date(date_labels = "%Y-%m") +
    scale_y_continuous(labels = scales::label_number_si()) +
    theme_minimal() +
    theme(
     panel.grid.major.y = element_blank(),
     axis.text.y = element_text(margin = margin(r = -15)),
     plot.caption = element_text(face = "italic", color = "darkgrey", margin = margin(t = 10))
  ) +
    labs(
      title = "AQI levels from March 2020-March 2021",
      subtitle = "Pollutant: PM2.5",
      fill = NULL,
      x = "Date",
      y = "AQI Level",
      caption = "Source: EPA"
    )
```
Interactive line graph with both pollutants: 
#figure out how to include by county in hover text
```{r}
a <- ggplot(merged_data) +
  aes(x = date, y = aqi, color = pollutant) +
  geom_line() +
  scale_x_date(date_labels = "%Y-%m") +
  scale_y_continuous(labels = scales::label_number_si()) +
  theme_minimal() +
  theme(
     panel.grid.major.y = element_blank(),
     axis.text.y = element_text(margin = margin(r = -15)),
     plot.caption = element_text(face = "italic", color = "darkgrey", margin = margin(t = 10))
  ) +
  labs(
    title = "AQI Levels from March 2020-March 2021",
    subtitle = "By Pollutant: Ozone and PM2.5",
    color = NULL,
    x = "Date",
    y = "AQI Level",
    caption = "Source: EPA"
  )
ggplotly(a)
```
Interactive line graph for just PM2.5: 
#figure out how to include by county in hover text
```{r}
b <- merged_data %>% 
  filter(pollutant %in% c("PM2.5")) %>% 
  ggplot() +
    aes(x = date, y = aqi, color = pollutant) +
    geom_line() +
    scale_x_date(date_labels = "%Y-%m") +
    scale_y_continuous(labels = scales::label_number_si()) +
    theme_minimal() +
    theme(
      panel.grid.major.y = element_blank(),
      axis.text.y = element_text(margin = margin(r = -15)),
      plot.caption = element_text(face = "italic", color = "darkgrey", margin = margin(t = 10))
  ) +
    labs(
    title = "AQI Levels from March 2020-March 2021",
    subtitle = "Pollutant: PM2.5",
    color = NULL,
    x = "Date",
    y = "AQI Level",
    caption = "Source: EPA"
  )
ggplotly(b)
```
Interactive line graph with just Ozone:
#figure out how to include by county in hover text
```{r}
c <- merged_data %>% 
  filter(pollutant %in% c("Ozone")) %>% 
  ggplot() +
    aes(x = date, y = aqi, color = pollutant) +
    geom_line() +
    scale_x_date(date_labels = "%Y-%m") +
    scale_y_continuous(labels = scales::label_number_si()) +
    theme_minimal() +
    theme(
      panel.grid.major.y = element_blank(),
      axis.text.y = element_text(margin = margin(r = -15)),
      plot.caption = element_text(face = "italic", color = "darkgrey", margin = margin(t = 10))
  ) +
    labs(
    title = "AQI Levels from March 2020-March 2021",
    subtitle = "Pollutant: Ozone",
    color = NULL,
    x = "Date",
    y = "AQI Level",
    caption = "Source: EPA"
  )
ggplotly(c)
```
COVID deaths bar graph:
#get feedback on this 
```{r}
ggplot(merged_data) +
  aes(x = date, y = deaths, fill = county) +
  geom_col(stat = "identity", position = "dodge") +
  scale_x_date(date_labels = "%Y-%m") +
  scale_y_continuous(labels = scales::label_number_si()) +
  theme_minimal() +
  theme(
    panel.grid.major.y = element_blank(),
    axis.text.y = element_text(margin = margin(r = -15)),
    plot.caption = element_text(face = "italic", color = "darkgrey", margin = margin(t = 10))
  ) +
  labs(
    title = "COVID Deaths in NYS from March 2020-March 2021",
    subtitle = "By County",
    fill = NULL,
    x = "Date",
    y = "COVID Deaths",
    caption = "Source: NYS Health"
  )
```
COVID Deaths line graph for select counties: 
```{r}
merged_data %>% 
  filter(county %in% c("Erie","Ontario","Onondaga","Queens","Albany","Rockland","Kings","Nassau")) %>% 
  ggplot() +
   aes(x = date, y = deaths, color = county) +
   geom_line() +
   scale_x_date(date_labels = "%Y-%m") +
   scale_y_continuous(labels = scales::label_number_si()) +
   theme_minimal() +
   theme(
     panel.grid.major.y = element_blank(),
     axis.text.y = element_text(margin = margin(r = -15)),
     plot.caption = element_text(face = "italic", color = "darkgrey", margin = margin(t = 10))
  ) +
   labs(
    title = "COVID Deaths in NYS from March 2020-March 2021",
    subtitle = "Select Counties",
    color = NULL,
    x = "Date",
    y = "COVID deaths",
    caption = "Source: NYS Health"
  )
```
Interactive COVID Deaths line graph (all counties): 
#get feedback on this 
```{r}
d <- ggplot(merged_data) +
   aes(x = date, y = deaths, color = county) +
   geom_line() +
   scale_x_date(date_labels = "%Y-%m") +
   scale_y_continuous(labels = scales::label_number_si()) +
   theme_minimal() +
   theme(
     panel.grid.major.y = element_blank(),
     axis.text.y = element_text(margin = margin(r = -15)),
     plot.caption = element_text(face = "italic", color = "darkgrey", margin = margin(t = 10))
  ) +
   labs(
    title = "COVID Deaths in NYS from March 2020-March 2021",
    subtitle = "By County",
    color = NULL,
    x = "Date",
    y = "COVID deaths",
    caption = "Source: NYS Health"
  )
ggplotly(d)
```

Basic Stats 

average aqi by county (ozone and PM2.5 combined)
```{r}
merged_data %>% 
  group_by(county) %>% 
  summarize(avg_aqi = mean(aqi)) 
ungroup(merged_data)
```
average aqi by county by pollutant
```{r}
merged_data %>% 
  group_by(pollutant, county) %>% 
  summarize(avg_AQI = mean(aqi)) 
ungroup(merged_data)
```
average aqi across counties separated by pollutant 
```{r}
merged_data %>% 
  group_by(pollutant) %>% 
  summarize(avg_AQI = mean(aqi)) 
ungroup(merged_data)
```

average COVID deaths by county 
```{r}
merged_data %>% 
  group_by(county) %>% 
  summarize(avg_death = mean(deaths)) 
ungroup(merged_data)
```

